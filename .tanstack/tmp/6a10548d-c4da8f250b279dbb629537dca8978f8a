import { useQuery } from '@tanstack/react-query';
import { Link, createLazyFileRoute } from '@tanstack/react-router';
import { getProduct } from '../../api/products';
import type { productProps } from '../../types/props';

export const Route = createLazyFileRoute('/products/')({
  component: RouteComponent,
});

function RouteComponent() {
  const { isPending, error, data } = useQuery({
    queryKey: ['products'],
    queryFn: getProduct,
  });

  if (isPending) return 'Loading...';

  if (error) return 'An error has occurred: ' + error.message;

  return (
    <div className="grid gap-2">
      {data.map((p: productProps) => (
        <Link
          to="/products/$productId"
          key={p.id}
          params={{ productId: p.id }}
          search={{
            title: p.title,
            description: p.description,
            image: p.image,
          }}>
          {p.title}
        </Link>
      ))}
    </div>
  );
}
